# WhatIf Backend

## Описание
WhatIf - это система для анализа исторических сценариев, использующая искусственный интеллект для генерации и валидации исторических данных. Бэкенд построен на Node.js с использованием TypeScript и Express.

## Технический стек
- Node.js
- TypeScript
- Express
- YandexGPT (AI модель)
- Axios для HTTP запросов

## Архитектура
Проект следует модульной архитектуре:
- `controllers/` - обработчики HTTP запросов
- `services/` - бизнес-логика
- `models/` - структуры данных
- `config/` - конфигурация
- `utils/` - вспомогательные функции

## Безопасность и приватность

### Проприетарность
- Система использует проприетарную модель YandexGPT
- Код проекта является открытым и доступен под MIT лицензией
- Модель AI является закрытой, но API документация публична

### Локация серверов
- Бэкенд размещен на Render (США)
- AI модель работает на серверах Яндекс.Облака (Россия)
- Все данные передаются по зашифрованным каналам

### Оплата и использование
- YandexGPT оплачивается по факту использования (pay-as-you-go)
- Минимальная стоимость запроса: 0.1 рубля
- Есть бесплатный тестовый период
- Возможна настройка лимитов использования

## Почему YandexGPT?
1. **Качество ответов**:
   - Специализированная модель для русского языка
   - Высокая точность в историческом контексте
   - Поддержка академических источников

2. **Технические преимущества**:
   - Низкая латентность
   - Стабильное API
   - Хорошая документация
   - Поддержка на русском языке

3. **Безопасность**:
   - Данные обрабатываются в юрисдикции РФ
   - Соответствие требованиям 152-ФЗ
   - Регулярные аудиты безопасности

## Возможность миграции
Система спроектирована с учетом возможности замены AI модели:

1. **Абстракция AI сервиса**:
   - Используется паттерн Adapter
   - Легкая замена провайдера AI
   - Минимальные изменения в коде

2. **Альтернативные модели**:
   - DeepSeek
   - GPT-4
   - Claude
   - Локальные модели (например, LLaMA)

3. **Процесс миграции**:
   - Создание нового адаптера
   - Тестирование на тестовом наборе
   - Постепенный переход
   - Сохранение качества ответов

## Установка и запуск

### Требования
- Node.js 18+
- npm или yarn
- Аккаунт Яндекс.Облака

### Переменные окружения
```env
YANDEX_FOLDER_ID=ваш_id_папки
YANDEX_IAM_TOKEN=ваш_iam_токен
```

### Установка
```bash
npm install
npm run build
npm start
```

## API Endpoints

### POST /api/generate
Генерация исторического сценария

**Request:**
```json
{
  "query": "Что если бы Наполеон выиграл битву при Ватерлоо?"
}
```

**Response:**
```json
{
  "text": "Анализ исторического сценария...",
  "facts": [...],
  "sources": [...],
  "confidence": 0.85,
  "unknownAreas": []
}
```

## Почему YandexGPT, а не DeepSeek?

### 1. Технические аспекты
- **Языковая специализация**:
  - YandexGPT специально обучена на русскоязычных исторических данных
  - DeepSeek имеет меньшую специализацию по русскому языку
  - YandexGPT лучше понимает контекст российской истории

- **Качество ответов**:
  - YandexGPT показывает лучшие результаты в анализе исторических источников на русском языке
  - Более точная работа с датами и историческими фактами
  - Лучше понимает контекст российских исторических событий

### 2. Практические преимущества
- **Стабильность и доступность**:
  - YandexGPT имеет стабильное API с низкой латентностью
  - Серверы расположены географически ближе
  - Техническая поддержка на русском языке

- **Стоимость**:
  - YandexGPT имеет более гибкую систему тарификации
  - Нет необходимости в предоплате
  - Прозрачная система учета использования

### 3. Юридические аспекты
- **Соответствие законодательству**:
  - YandexGPT соответствует требованиям 152-ФЗ
  - Данные обрабатываются в юрисдикции РФ
  - Прозрачные условия использования

- **Безопасность данных**:
  - Четкая политика обработки персональных данных
  - Регулярные аудиты безопасности
  - Соответствие международным стандартам

### 4. Почему не DeepSeek
- **Ограничения для российских пользователей**:
  - Потенциальные проблемы с доступом
  - Неопределенный правовой статус
  - Возможные ограничения в будущем

- **Технические ограничения**:
  - Меньшая специализация по русскому языку
  - Ограниченный доступ к российским историческим источникам
  - Потенциальные проблемы с API в России

### 5. Возможность перехода
Система спроектирована так, что при необходимости можно перейти на DeepSeek:
- Модульная архитектура позволяет легко заменить AI провайдера
- Есть готовые адаптеры для других моделей
- Процесс миграции документирован
- Сохранение качества ответов гарантировано тестами

### 6. Будущее развитие
- Планируется поддержка нескольких AI моделей
- Возможность выбора модели в зависимости от задачи
- Интеграция с локальными моделями
- Постоянный мониторинг качества ответов
- MCP сервер

## Почему Render?

### 1. Технические преимущества
- **Простота развертывания**:
  - Автоматический деплой из Git
  - Встроенная поддержка Node.js
  - Автоматическое масштабирование
  - SSL сертификаты из коробки

- **Надежность**:
  - 99.9% uptime
  - Автоматические бэкапы
  - Мониторинг и логирование
  - Быстрое восстановление после сбоев

### 2. Стоимость и экономика
- **Прозрачная тарификация**:
  - Pay-as-you-go модель
  - Нет скрытых платежей
  - Предсказуемые расходы
  - Бесплатный тир для разработки

- **Экономическая эффективность**:
  - Оптимальное соотношение цена/качество
  - Экономия на DevOps
  - Автоматическое масштабирование под нагрузку
  - Нет необходимости в отдельном DevOps инженере

### 3. Альтернативы и их недостатки
- **Heroku**:
  - Более дорогой
  - Ограниченная поддержка
  - Меньше возможностей для масштабирования

- **DigitalOcean**:
  - Требует больше ручной настройки
  - Нет автоматического деплоя
  - Нужен DevOps инженер

- **AWS/GCP/Azure**:
  - Сложная настройка
  - Высокая стоимость
  - Избыточный функционал для проекта

### 4. Безопасность
- **Встроенные механизмы**:
  - DDoS защита
  - Firewall
  - SSL/TLS
  - Регулярные обновления безопасности

- **Соответствие стандартам**:
  - GDPR
  - SOC 2
  - ISO 27001
  - Регулярные аудиты

### 5. Гибкость и масштабируемость
- **Автоматическое масштабирование**:
  - Под нагрузку
  - По времени
  - По метрикам

- **Интеграции**:
  - GitHub/GitLab
  - Slack
  - Prometheus
  - Grafana

### 6. Поддержка и документация
- **Техническая поддержка**:
  - 24/7
  - Быстрые ответы
  - Профессиональная команда

- **Документация**:
  - Подробные гайды
  - Примеры кода
  - Регулярные обновления

### 7. Возможность миграции
Система спроектирована так, что при необходимости можно легко перенести на другую платформу:
- Контейнеризация (Docker)
- Инфраструктура как код
- Документированный процесс миграции
- Минимальное время простоя при переносе